<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/jquery.marquee.min.js"></script>
<script type="text/javascript" src="js/slideshow.js"></script>
<!-- <script type="text/javascript" src="js/schedule.js"></script> -->
<link rel="stylesheet" type="text/css" href="css/marquee.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">
<div id="app">
    <div id="wrapper">
        <h1 class="glitch" data-text="No">No</h1>
        <h2 class="glitch" data-text="School">School</h2>
    </div>
</div>
<div class="marquee-container">
    <pre>|<div id="marquee" class="marquee"></div>|</pre>
</div>
<script>
    function main() {
        const jsonData = {
            "schedule": [{
                "monday": [{
                    "1": "Homeroom - 613",
                    "2": "Algebra II - 607",
                    "3": "Programming - 527",
                    "4": "Post-secondary Planning - 605",
                    "5": "Lunch",
                    "6": "Global II - 613",
                    "7": "Biology - Lab 2",
                    "8": "Programming - 527",
                    "9": "Global II - 613"
                }],
                "tuesday": [{
                    "1": "Homeroom - 613",
                    "2": "Algebra II - 607",
                    "3": "Global II - 613",
                    "4": "World Literature - 621",
                    "5": "Lunch",
                    "6": "Art Independent Study - 618",
                    "7": "Movement - 630",
                    "8": "Biology - Lab 2"
                }],
                "wednesday": [{
                    "1": "Homeroom - 613",
                    "2": "Algebra II - 607",
                    "3": "Global II - 613",
                    "4": "World Literature - 621",
                    "5": "Lunch",
                    "6": "Art Independent Study - 618",
                    "7": "Spanish - 627",
                    "8": "Biology - Lab 2"
                }],
                "thursday": [{
                    "1": "Homeroom - 613",
                    "2": "Spanish - 627",
                    "3": "ELA",
                    "4": "Counseling - 602",
                    "5": "Programming - 527",
                    "6": "Lunch",
                    "7": "Student Life",
                    "8": "Biology - Lab 2",
                    "9" : "Algebra II - 607",
                    "10" : "Advisory - 613"
                }],
                "friday": [{
                    "1": "Homeroom - 613",
                    "2": "World Literature - 621",
                    "3": "Spanish - 627",
                    "4": "Idea Lab"
                }]
            }]
        }
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September",
            "October", "November", "December"
        ];
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const d = new Date(new Date().toLocaleString("en-US", {timeZone: "America/New_York"}));
        let hour = d.getHours()
        let minute = d.getMinutes()
        let month = months[d.getMonth()];
        let daynum = d.getDate();
        let year = d.getUTCFullYear()
        let day = days[d.getDay()];
        if (day == "Sunday" || day == "Saturday") {
            school = false
        }
        if (day !== "Sunday" && day !== "Saturday") {
            function checkperiod() {
            if (day !== "Monday" && day !== "Thursday"){
                currentperiod = 0
                school = true
                thing1 = 0
                thing2 = 0
                if (hour == 8 && minute >= 40 || hour == 9 && minute <= 0) {
                    currentperiod = 1
                    thing1 = 9
                    thing2 = 0
                } else if (hour == 9 && minute >= 1 || hour == 10 && minute <= 0) {
                    currentperiod = 2
                    thing1 = 10
                    thing2 = 0
                } else if (hour == 10 && minute >= 1 || hour == 11 && minute <= 0) {
                    currentperiod = 3
                    thing1 = 11
                    thing2 = 0
                } else if (hour == 11 && minute >= 1 || hour == 12 && minute <= 0) {
                    currentperiod = 4
                    thing1 = 12
                    thing2 = 0
                } else if (hour == 12 && minute >= 1 && hour == 12 && minute <= 30) {
                    currentperiod = 5
                    thing1 = 12
                    thing2 = 30
                } else if (hour == 12 && minute >= 31 || hour == 13 && minute <= 30) {
                    currentperiod = 6
                    thing1 = 13
                    thing2 = 30
                } else if (hour == 13 && minute >= 31 || hour == 14 && minute <= 30) {
                    currentperiod = 7
                    thing1 = 14
                    thing2 = 30
                } else if (hour == 14 && minute >= 31 || hour == 15 && minute <= 30) {
                    currentperiod = 8
                    thing1 = 15
                    thing2 = 30
                } else {
                    currentperiod = 0
                    thing1 = 0
                    thing2 = 0
                    school = false
                }
                if (day == "Friday" && currentperiod >= 5) {
                    school = false
                }}
            else if (day == "Monday"){
                currentperiod = 0
                school = true
                thing1 = 0
                thing2 = 0
                if (hour == 8 && minute >= 40 || hour == 9 && minute <= 0) {
                    currentperiod = 1
                    thing1 = 9
                    thing2 = 0
                } else if (hour == 9 && minute >= 1 || hour == 10 && minute <= 0) {
                    currentperiod = 2
                    thing1 = 10
                    thing2 = 0
                } else if (hour == 10 && minute >= 1 || hour == 11 && minute <= 0) {
                    currentperiod = 3
                    thing1 = 11
                    thing2 = 0
                } else if (hour == 11 && minute >= 1 || hour == 12 && minute <= 0) {
                    currentperiod = 4
                    thing1 = 12
                    thing2 = 0
                } else if (hour == 12 && minute >= 1 && hour == 12 && minute <= 30) {
                    currentperiod = 5
                    thing1 = 12
                    thing2 = 30
                } else if (hour == 12 && minute >= 31 || hour == 13 && minute <= 0) {
                    currentperiod = 6
                    thing1 = 13
                    thing2 = 0
                } else if (hour == 13 && minute >= 1 && minute <= 30) {
                    currentperiod = 7
                    thing1 = 13
                    thing2 = 30
                } else if (hour == 13 && minute >= 31 || hour == 14 && minute <= 30) {
                    currentperiod = 8
                    thing1 = 15
                    thing2 = 30
                } else if (hour == 14 && minute >= 31 || hour == 15 && minute <= 30) {
                    currentperiod = 9
                    thing1 = 15
                    thing2 = 30
                } else {
                    currentperiod = 0
                    thing1 = 0
                    thing2 = 0
                    school = false
                }
                if (day == "Friday" && currentperiod >= 5) {
                    school = false
                }
            }
            else if (day == "Thursday") {
                currentperiod = 0
                school = true
                thing1 = 0
                thing2 = 0
                if (hour == 8 && minute >= 40 || hour == 9 && minute <= 0) {
                    currentperiod = 1
                    thing1 = 9
                    thing2 = 0
                } else if (hour == 9 && minute >= 1 || hour == 10 && minute <= 0) {
                    currentperiod = 2
                    thing1 = 10
                    thing2 = 0
                } else if (hour == 10 && minute >= 1 && hour == 10 && minute <= 30) {
                    currentperiod = 3
                    thing1 = 10
                    thing2 = 30
                } else if (hour == 10 && minute >= 31 || hour == 11 && minute <= 0) {
                    currentperiod = 4
                    thing1 = 11
                    thing2 = 0
                } else if (hour == 11 && minute >= 1 || hour == 12 && minute <= 0) {
                    currentperiod = 5
                    thing1 = 12
                    thing2 = 0
                } else if (hour == 12 && minute >= 1 && hour == 12 && minute <= 30) {
                    currentperiod = 6
                    thing1 = 12
                    thing2 = 30
                } else if (hour == 12 && minute >= 31 || hour == 13 && minute <= 30) {
                    currentperiod = 7
                    thing1 = 13
                    thing2 = 30
                } else if (hour == 13 && minute >= 31 || hour == 14 && minute <= 30) {
                    currentperiod = 8
                    thing1 = 14
                    thing2 = 30
                } else if (hour == 14 && minute >= 31 || hour == 15 && minute <= 0) {
                    currentperiod = 9
                    thing1 = 15
                    thing2 = 0
                } else if (hour == 15 && minute >= 1 && hour == 15 && minute <= 30) {
                    currentperiod = 9
                    thing1 = 15
                    thing2 = 30
                } else {
                    currentperiod = 0
                    thing1 = 0
                    thing2 = 0
                    school = false
                }
                if (day == "Friday" && currentperiod >= 5) {
                    school = false
                }
            }
                return [currentperiod, thing1, thing2, school]
            }

            function getTimeRemaining(endtime) {
                const total = Date.parse(endtime) - Date.parse(new Date(new Date().toLocaleString("en-US", {timeZone: "America/New_York"})));
                const seconds = Math.floor((total / 1000) % 60);
                const minutes = Math.floor((total / 1000 / 60) % 60);
                const hours = Math.floor((total / (1000 * 60 * 60)) % 24);
                const days = Math.floor(total / (1000 * 60 * 60 * 24));
                return {
                    total,
                    days,
                    hours,
                    minutes,
                    seconds
                };
            }
        if (checkperiod()[3] == true){
            const period = new Date(`${month} ${daynum}, ${year} ${checkperiod()[1]}:${checkperiod()[2]}:00`)
            // console.log(period)
            // console.log(`${month} ${daynum}, ${year} ${checkperiod()[1]}:${checkperiod()[2]}:00`)
            // console.log(getTimeRemaining(period))
            let ok = getTimeRemaining(period).minutes
            // Notification.requestPermission((status) => {
            //     console.log(status)
            // if (status == "granted") {
            //     console.log('h')
            //     if (ok < 5){
            //     const notification = new Notification('Asher Schedule Reminder', { body: "5 Minutes until next period!" });
            // }}})
            // console.log(ok)
            // console.log(ok.toString().replace("-", ""))
            var styleElem = document.getElementsByClassName("glitch")[0];
            styleElem.innerHTML = jsonData['schedule'][0][day.toLowerCase()][0][checkperiod()[0]]
            document.body.innerHTML = document.body.innerHTML.replace('No', jsonData['schedule'][0][day.toLowerCase()]
                [0][checkperiod()[0]])
            function updateClock() {
                const t = getTimeRemaining(period);
                if (t.seconds < 10){
                    document.getElementsByClassName("glitch")[1].dataset.text = t.minutes + ":" + "0" + t.seconds;
                    document.getElementsByClassName("glitch")[1].innerHTML = t.minutes + ":" + "0" + t.seconds;
                }
                else if (t.seconds >= 10){
                document.getElementsByClassName("glitch")[1].dataset.text = t.minutes + ":" + t.seconds;
                document.getElementsByClassName("glitch")[1].innerHTML = t.minutes + ":" + t.seconds;
                }
                if (t.minutes <= 0 && t.seconds <= 0) {
                    location.reload();
                    clearInterval(timeinterval);
                }
            }

            updateClock();
            var timeinterval = setInterval(updateClock, 1000);
        }
    } 
}
main()
</script>
